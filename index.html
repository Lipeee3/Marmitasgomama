<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Sistema de Gestão de Vendas</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        theme: {
          extend: {
            colors: {
              primary: "#2563eb",
              secondary: "#64748b",
            },
            borderRadius: {
              none: "0px",
              sm: "4px",
              DEFAULT: "8px",
              md: "12px",
              lg: "16px",
              xl: "20px",
              "2xl": "24px",
              "3xl": "32px",
              full: "9999px",
              button: "8px",
            },
          },
        },
      };
    </script>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Pacifico&display=swap"
      rel="stylesheet"
    />
    <link
      href="https://cdn.jsdelivr.net/npm/remixicon@4.5.0/fonts/remixicon.css"
      rel="stylesheet"
    />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/echarts/5.5.0/echarts.min.js"></script>
    <style>
      :where([class^="ri-"])::before {
        content: "\f3c2";
      }
      select::-ms-expand {
        display: none;
      }
      select {
        -webkit-appearance: none;
        -moz-appearance: none;
        appearance: none;
      }
      input[type="number"]::-webkit-inner-spin-button,
      input[type="number"]::-webkit-outer-spin-button {
        -webkit-appearance: none;
        margin: 0;
      }
      .table-container {
        overflow-x: auto;
      }
    </style>
  </head>
  <body class="bg-gray-50 min-h-screen">
    <nav class="bg-white shadow-sm">
      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="flex justify-between h-16">
          <div class="flex items-center">
            <span class="font-['Pacifico'] text-2xl text-primary">Rojo - GoMama</span>
          </div>
          <div class="flex items-center space-x-4">
            <button class="text-gray-600 hover:text-gray-900">
              <div class="w-8 h-8 flex items-center justify-center">
                <i class="ri-notification-line text-xl"></i>
              </div>
            </button>
            <button class="text-gray-600 hover:text-gray-900">
              <div class="w-8 h-8 flex items-center justify-center">
                <i class="ri-user-line text-xl"></i>
              </div>
            </button>
          </div>
        </div>
      </div>
    </nav>

    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
      <div
        class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-8 gap-4"
      >
        <h1 class="text-2xl font-bold text-gray-900">Gestão de Vendas</h1>
        <div class="flex flex-wrap gap-4">
          <button
            id="newSaleBtn"
            class="bg-primary text-white px-4 py-2 !rounded-button flex items-center space-x-2 whitespace-nowrap cursor-pointer"
          >
            <div class="w-5 h-5 flex items-center justify-center">
              <i class="ri-add-line"></i>
            </div>
            <span>Nova Venda</span>
          </button>
          <button
            id="uploadXMLBtn"
            class="bg-secondary text-white px-4 py-2 !rounded-button flex items-center space-x-2 whitespace-nowrap cursor-pointer"
          >
            <div class="w-5 h-5 flex items-center justify-center">
              <i class="ri-upload-line"></i>
            </div>
            <span>Upload XML</span>
          </button>
          <div class="relative" id="exportDropdown">
            <button
              class="bg-secondary text-white px-4 py-2 !rounded-button flex items-center space-x-2 whitespace-nowrap cursor-pointer"
            >
              <div class="w-5 h-5 flex items-center justify-center">
                <i class="ri-download-line"></i>
              </div>
              <span>Exportar</span>
            </button>
          </div>
        </div>
      </div>

      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
        <div class="bg-white p-6 rounded-lg shadow-sm">
          <div class="flex justify-between items-center mb-4">
            <h3 class="text-lg font-semibold text-gray-900">Total de Vendas</h3>
            <div class="w-8 h-8 flex items-center justify-center text-primary">
              <i class="ri-line-chart-line text-2xl"></i>
            </div>
          </div>
          <p id="totalSalesValue" class="text-3xl font-bold text-gray-900">
            R$ 158.234,00
          </p>
          <div id="totalSalesChart" class="h-32 mt-4"></div>
        </div>

        <div class="bg-white p-6 rounded-lg shadow-sm">
          <div class="flex justify-between items-center mb-4">
            <h3 class="text-lg font-semibold text-gray-900">
              Quantidade de Vendas
            </h3>
            <div class="w-8 h-8 flex items-center justify-center text-primary">
              <i class="ri-shopping-bag-line text-2xl"></i>
            </div>
          </div>
          <p id="salesQuantityValue" class="text-3xl font-bold text-gray-900">
            1.284
          </p>
          <div id="salesQuantityChart" class="h-32 mt-4"></div>
        </div>

        <div class="bg-white p-6 rounded-lg shadow-sm">
          <div class="flex justify-between items-center mb-4">
            <h3 class="text-lg font-semibold text-gray-900">Média por Venda</h3>
            <div class="w-8 h-8 flex items-center justify-center text-primary">
              <i class="ri-funds-line text-2xl"></i>
            </div>
          </div>
          <p id="averageSaleValue" class="text-3xl font-bold text-gray-900">
            R$ 123,24
          </p>
          <div id="averageSaleChart" class="h-32 mt-4"></div>
        </div>

        <div class="bg-white p-6 rounded-lg shadow-sm">
          <div class="flex justify-between items-center mb-4">
            <h3 class="text-lg font-semibold text-gray-900">Lucro Total</h3>
            <div class="w-8 h-8 flex items-center justify-center text-primary">
              <i class="ri-money-dollar-circle-line text-2xl"></i>
            </div>
          </div>
          <p id="totalProfitValue" class="text-3xl font-bold text-gray-900">
            R$ 47.470,20
          </p>
          <div id="totalProfitChart" class="h-32 mt-4"></div>
        </div>
      </div>

      <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
        <div class="bg-white p-6 rounded-lg shadow-sm">
          <h3 class="text-lg font-semibold text-gray-900 mb-4">
            Participação por Cliente
          </h3>
          <div id="customerShareChart" class="h-64"></div>
        </div>
        <div class="bg-white p-6 rounded-lg shadow-sm">
          <h3 class="text-lg font-semibold text-gray-900 mb-4">
            Evolução de Vendas
          </h3>
          <div id="salesEvolutionChart" class="h-64"></div>
        </div>
      </div>

      <div class="bg-white rounded-lg shadow-sm overflow-hidden">
        <div class="p-6 border-b border-gray-200">
          <div
            class="flex flex-col sm:flex-row justify-between items-start sm:items-center space-y-4 sm:space-y-0"
          >
            <h3 class="text-lg font-semibold text-gray-900">
              Registros de Vendas
            </h3>
            <div class="flex items-center space-x-4">
              <div class="relative">
                <input
                  id="searchInput"
                  type="text"
                  placeholder="Pesquisar..."
                  class="pl-10 pr-4 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent"
                />
                <div
                  class="absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 flex items-center justify-center text-gray-400"
                >
                  <i class="ri-search-line"></i>
                </div>
              </div>
              <button class="text-gray-600 hover:text-gray-900">
                <div class="w-8 h-8 flex items-center justify-center">
                  <i class="ri-filter-line text-xl"></i>
                </div>
              </button>
            </div>
          </div>
        </div>
        <div class="table-container">
          <table class="w-full">
            <thead class="bg-gray-50">
              <tr>
                <th
                  class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                >
                  ID
                </th>
                <th
                  class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                >
                  Produto
                </th>
                <th
                  class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                >
                  Valor Unit.
                </th>
                <th
                  class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                >
                  Qtd.
                </th>
                <th
                  class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                >
                  Total
                </th>
                <th
                  class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                >
                  Cliente
                </th>
                <th
                  class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                >
                  NF
                </th>
                <th
                  class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                >
                  Data
                </th>
                <th
                  class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                >
                  Ações
                </th>
              </tr>
            </thead>
            <tbody
              id="salesTableBody"
              class="bg-white divide-y divide-gray-200"
            >
              <!-- Dados da tabela serão inseridos dinamicamente via JavaScript -->
            </tbody>
          </table>
        </div>
        <div class="px-6 py-4 border-t border-gray-200">
          <div class="flex justify-between items-center">
            <div id="paginationInfo" class="text-sm text-gray-700">
              Mostrando <span class="font-medium">1</span> até
              <span class="font-medium">10</span> de
              <span class="font-medium">97</span> resultados
            </div>
            <div class="flex space-x-2">
              <button
                id="prevPageBtn"
                class="px-3 py-1 border border-gray-300 rounded-md text-sm font-medium text-gray-700 hover:bg-gray-50"
              >
                Anterior
              </button>
              <button
                id="nextPageBtn"
                class="px-3 py-1 border border-gray-300 rounded-md text-sm font-medium text-gray-700 hover:bg-gray-50"
              >
                Próximo
              </button>
            </div>
          </div>
        </div>
      </div>
    </main>

    <div
      id="newSaleModal"
      class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50"
    >
      <div class="bg-white rounded-lg w-full max-w-2xl mx-4">
        <div class="px-6 py-4 border-b border-gray-200">
          <h3 class="text-lg font-semibold text-gray-900">Nova Venda</h3>
        </div>
        <form id="saleForm" class="p-6">
          <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1"
                >Produto</label
              >
              <input
                name="product"
                type="text"
                class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent"
                required
              />
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1"
                >Valor Unitário</label
              >
              <input
                name="unitPrice"
                type="number"
                step="0.01"
                class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent"
                required
              />
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1"
                >Quantidade</label
              >
              <input
                name="quantity"
                type="number"
                class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent"
                required
              />
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1"
                >Cliente</label
              >
              <input
                name="customer"
                type="text"
                class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent"
                required
              />
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1"
                >Nota Fiscal</label
              >
              <input
                name="invoice"
                type="text"
                class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent"
                required
              />
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1"
                >Data</label
              >
              <input
                name="date"
                type="date"
                class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent"
                required
              />
            </div>
          </div>
        </form>
        <div
          class="px-6 py-4 border-t border-gray-200 flex justify-end space-x-4"
        >
          <button
            id="cancelSaleBtn"
            class="px-4 py-2 text-gray-700 hover:text-gray-900 !rounded-button whitespace-nowrap cursor-pointer"
          >
            Cancelar
          </button>
          <button
            type="submit"
            form="saleForm"
            class="bg-primary text-white px-4 py-2 !rounded-button whitespace-nowrap cursor-pointer"
          >
            Salvar
          </button>
        </div>
      </div>
    </div>

    <script>
      // Dados iniciais de vendas com formato mais completo
      const salesData = [
        {
          id: 1234,
          product: "Feijoada Completa",
          unitPrice: 45.0,
          quantity: 2,
          total: 90.0,
          customer: "Restaurante Silva",
          invoice: "NF-123456",
          date: "2025-03-12",
          formattedDate: "12/03/2025",
        },
        {
          id: 1235,
          product: "Picanha Premium",
          unitPrice: 89.9,
          quantity: 3,
          total: 269.7,
          customer: "Restaurante Silva",
          invoice: "NF-123457",
          date: "2025-03-11",
          formattedDate: "11/03/2025",
        },
        {
          id: 1236,
          product: "Pão Francês",
          unitPrice: 0.75,
          quantity: 100,
          total: 75.0,
          customer: "Padaria Central",
          invoice: "NF-123458",
          date: "2025-03-10",
          formattedDate: "10/03/2025",
        },
        {
          id: 1237,
          product: "Arroz 5kg",
          unitPrice: 22.5,
          quantity: 10,
          total: 225.0,
          customer: "Mercado São José",
          invoice: "NF-123459",
          date: "2025-03-09",
          formattedDate: "09/03/2025",
        },
        {
          id: 1238,
          product: "Cerveja 600ml",
          unitPrice: 8.9,
          quantity: 24,
          total: 213.6,
          customer: "Bar do João",
          invoice: "NF-123460",
          date: "2025-03-08",
          formattedDate: "08/03/2025",
        },
      ];

      // Variáveis para estatísticas e gráficos
      let currentPage = 1;
      const itemsPerPage = 10;
      const charts = {};
      const monthNames = [
        "Jan",
        "Fev",
        "Mar",
        "Abr",
        "Mai",
        "Jun",
        "Jul",
        "Ago",
        "Set",
        "Out",
        "Nov",
        "Dez",
      ];

      // Função para formatar valores monetários
      function formatCurrency(value) {
        return new Intl.NumberFormat("pt-BR", {
          style: "currency",
          currency: "BRL",
        }).format(value);
      }

      // Função para formatar números
      function formatNumber(value) {
        return new Intl.NumberFormat("pt-BR").format(value);
      }

      // Função para atualizar a tabela de vendas
      function updateSalesTable() {
        const start = (currentPage - 1) * itemsPerPage;
        const end = start + itemsPerPage;
        const displayData = salesData.slice(start, end);

        const tableBody = document.getElementById("salesTableBody");
        tableBody.innerHTML = "";

        displayData.forEach((sale) => {
          const row = document.createElement("tr");
          row.innerHTML = `
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">#${
                      sale.id
                    }</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${
                      sale.product
                    }</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${formatCurrency(
                      sale.unitPrice
                    )}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${
                      sale.quantity
                    }</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${formatCurrency(
                      sale.total
                    )}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${
                      sale.customer
                    }</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${
                      sale.invoice
                    }</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${
                      sale.formattedDate
                    }</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                        <div class="flex space-x-2">
                            <button class="text-primary hover:text-primary-dark" onclick="editSale(${
                              sale.id
                            })">
                                <div class="w-5 h-5 flex items-center justify-center">
                                    <i class="ri-edit-line"></i>
                                </div>
                            </button>
                            <button class="text-red-600 hover:text-red-700" onclick="deleteSale(${
                              sale.id
                            })">
                                <div class="w-5 h-5 flex items-center justify-center">
                                    <i class="ri-delete-bin-line"></i>
                                </div>
                            </button>
                        </div>
                    </td>
                `;
          tableBody.appendChild(row);
        });

        // Atualizar paginação
        const totalPages = Math.ceil(salesData.length / itemsPerPage);
        const endItem = Math.min(end, salesData.length);
        document.getElementById("paginationInfo").innerHTML = `
                Mostrando <span class="font-medium">${
                  start + 1
                }</span> até <span class="font-medium">${endItem}</span> de <span class="font-medium">${
          salesData.length
        }</span> resultados
            `;

        // Atualizar estado dos botões de paginação
        document.getElementById("prevPageBtn").disabled = currentPage === 1;
        document.getElementById("nextPageBtn").disabled =
          currentPage === totalPages;
      }

      // Função para calcular estatísticas
      function calculateStats() {
        // Calcular estatísticas gerais
        const totalSales = salesData.reduce((sum, sale) => sum + sale.total, 0);
        const totalQuantity = salesData.length;
        const averageSale = totalSales / totalQuantity;
        const totalProfit = totalSales * 0.3; // 30% de margem de lucro para exemplo

        // Atualizar exibição
        document.getElementById("totalSalesValue").textContent =
          formatCurrency(totalSales);
        document.getElementById("salesQuantityValue").textContent =
          formatNumber(totalQuantity);
        document.getElementById("averageSaleValue").textContent =
          formatCurrency(averageSale);
        document.getElementById("totalProfitValue").textContent =
          formatCurrency(totalProfit);

        // Preparar dados para gráficos
        const salesByMonth = new Array(12).fill(0);
        const quantityByMonth = new Array(12).fill(0);

        // Agrupar vendas por mês
        salesData.forEach((sale) => {
          const date = new Date(sale.date);
          const month = date.getMonth();
          salesByMonth[month] += sale.total;
          quantityByMonth[month]++;
        });

        // Agrupar vendas por cliente
        const customerData = {};
        salesData.forEach((sale) => {
          if (!customerData[sale.customer]) {
            customerData[sale.customer] = 0;
          }
          customerData[sale.customer] += sale.total;
        });

        // Preparar dados para o gráfico de participação por cliente
        const customerShareData = Object.entries(customerData).map(
          ([name, value]) => ({ name, value })
        );

        // Ordenar por valor e limitar a 5 principais
        customerShareData.sort((a, b) => b.value - a.value);
        const topCustomers = customerShareData.slice(0, 4);

        // Adicionar "Outros" se necessário
        if (customerShareData.length > 4) {
          const othersValue = customerShareData
            .slice(4)
            .reduce((sum, item) => sum + item.value, 0);
          topCustomers.push({ name: "Outros", value: othersValue });
        }

        return {
          totalSales,
          totalQuantity,
          averageSale,
          totalProfit,
          salesByMonth,
          quantityByMonth,
          customerShareData: topCustomers,
        };
      }

      // Função para inicializar os gráficos
      function initCharts() {
        const elements = [
          "totalSalesChart",
          "salesQuantityChart",
          "averageSaleChart",
          "totalProfitChart",
          "customerShareChart",
          "salesEvolutionChart",
        ];

        // Inicializar instâncias do ECharts
        elements.forEach((id) => {
          const element = document.getElementById(id);
          if (element) {
            charts[id] = echarts.init(element);
          }
        });

        // Atualizar gráficos com dados iniciais
        updateCharts();
      }

      // Função para atualizar gráficos com dados atuais
      function updateCharts() {
        const stats = calculateStats();

        // Opções comuns para os gráficos de linha pequenos
        const smallLineChartOptions = (data) => ({
          animation: false,
          grid: { top: 5, right: 5, bottom: 5, left: 5 },
          xAxis: {
            show: false,
            type: "category",
            data: monthNames,
          },
          yAxis: { show: false },
          series: [
            {
              type: "line",
              data: data,
              smooth: true,
              showSymbol: false,
              lineStyle: { color: "rgba(37, 99, 235, 1)" },
              areaStyle: {
                color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [
                  {
                    offset: 0,
                    color: "rgba(37, 99, 235, 0.3)",
                  },
                  {
                    offset: 1,
                    color: "rgba(37, 99, 235, 0.1)",
                  },
                ]),
              },
            },
          ],
        });

        // Gráfico de total de vendas
        if (charts.totalSalesChart) {
          charts.totalSalesChart.setOption(
            smallLineChartOptions(stats.salesByMonth)
          );
        }

        // Gráfico de quantidade de vendas
        if (charts.salesQuantityChart) {
          charts.salesQuantityChart.setOption(
            smallLineChartOptions(stats.quantityByMonth)
          );
        }

        // Gráfico de média por venda (usando uma versão simplificada)
        if (charts.averageSaleChart) {
          const avgByMonth = stats.salesByMonth.map((total, i) =>
            stats.quantityByMonth[i] ? total / stats.quantityByMonth[i] : 0
          );
          charts.averageSaleChart.setOption(smallLineChartOptions(avgByMonth));
        }

        // Gráfico de lucro total (30% de margem para exemplo)
        if (charts.totalProfitChart) {
          const profitByMonth = stats.salesByMonth.map((total) => total * 0.3);
          charts.totalProfitChart.setOption(
            smallLineChartOptions(profitByMonth)
          );
        }

        // Gráfico de participação por cliente
        if (charts.customerShareChart) {
          charts.customerShareChart.setOption({
            animation: false,
            tooltip: {
              trigger: "item",
              formatter: "{b}: {c} ({d}%)",
            },
            legend: {
              bottom: "0%",
              left: "center",
              textStyle: {
                color: "#64748b",
              },
            },
            series: [
              {
                type: "pie",
                radius: ["40%", "70%"],
                avoidLabelOverlap: false,
                itemStyle: {
                  borderRadius: 5,
                  borderColor: "#fff",
                  borderWidth: 2,
                },
                label: {
                  show: false,
                },
                emphasis: {
                  label: {
                    show: true,
                    fontSize: "14",
                    fontWeight: "bold",
                  },
                },
                labelLine: {
                  show: false,
                },
                data: stats.customerShareData,
              },
            ],
          });
        }

        // Gráfico de evolução de vendas
        if (charts.salesEvolutionChart) {
          // Formatar valores para exibição
          const formattedSalesByMonth = stats.salesByMonth.map((value) =>
            value ? value.toFixed(2) : 0
          );

          charts.salesEvolutionChart.setOption({
            animation: false,
            grid: { top: 40, right: 20, bottom: 80, left: 70 },
            tooltip: {
              trigger: "axis",
              formatter: function (params) {
                return `${params[0].name}: ${formatCurrency(params[0].value)}`;
              },
            },
            xAxis: {
              type: "category",
              data: monthNames,
              axisLine: { lineStyle: { color: "#E5E7EB" } },
              axisLabel: {
                rotate: 45,
                color: "#64748b",
              },
            },
            yAxis: {
              type: "value",
              splitLine: { lineStyle: { color: "#E5E7EB" } },
              axisLabel: {
                formatter: (value) => formatCurrency(value),
                color: "#64748b",
              },
            },
            series: [
              {
                data: formattedSalesByMonth,
                type: "bar",
                barWidth: "60%",
                itemStyle: {
                  color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [
                    { offset: 0, color: "#2563eb" },
                    { offset: 1, color: "#3b82f6" },
                  ]),
                },
              },
            ],
          });
        }
      }

      // Eventos para paginação
      document.getElementById("prevPageBtn").addEventListener("click", () => {
        if (currentPage > 1) {
          currentPage--;
          updateSalesTable();
        }
      });

      document.getElementById("nextPageBtn").addEventListener("click", () => {
        const totalPages = Math.ceil(salesData.length / itemsPerPage);
        if (currentPage < totalPages) {
          currentPage++;
          updateSalesTable();
        }
      });

      // Eventos para modal de nova venda
      document.getElementById("newSaleBtn").addEventListener("click", () => {
        document.getElementById("newSaleModal").classList.remove("hidden");
        document.getElementById("newSaleModal").classList.add("flex");
        document.getElementById("saleForm").reset();

        // Preencher data atual
        const today = new Date().toISOString().split("T")[0];
        document.querySelector('input[name="date"]').value = today;
      });

      document.getElementById("cancelSaleBtn").addEventListener("click", () => {
        document.getElementById("newSaleModal").classList.add("hidden");
        document.getElementById("newSaleModal").classList.remove("flex");
      });

      // Salvar nova venda
      document.getElementById("saleForm").addEventListener("submit", (e) => {
        e.preventDefault();

        // Obter dados do formulário
        const formData = new FormData(e.target);
        const product = formData.get("product");
        const unitPrice = parseFloat(formData.get("unitPrice"));
        const quantity = parseInt(formData.get("quantity"));
        const customer = formData.get("customer");
        const invoice = formData.get("invoice");
        const date = formData.get("date");

        // Calcular total
        const total = unitPrice * quantity;

        // Formatar data para exibição
        const dateObj = new Date(date);
        const formattedDate = `${String(dateObj.getDate()).padStart(
          2,
          "0"
        )}/${String(dateObj.getMonth() + 1).padStart(
          2,
          "0"
        )}/${dateObj.getFullYear()}`;

        // Gerar ID único
        const id = Math.max(0, ...salesData.map((s) => s.id)) + 1;

        // Adicionar nova venda
        salesData.unshift({
          id,
          product,
          unitPrice,
          quantity,
          total,
          customer,
          invoice,
          date,
          formattedDate,
        });

        // Atualizar tabela e gráficos
        updateSalesTable();
        updateCharts();

        // Fechar modal
        document.getElementById("newSaleModal").classList.add("hidden");
        document.getElementById("newSaleModal").classList.remove("flex");
      });

      // Funções para editar e excluir vendas
      window.editSale = function (id) {
        const sale = salesData.find((s) => s.id === id);
        if (!sale) return;

        // Abrir modal e preencher dados
        document.getElementById("newSaleModal").classList.remove("hidden");
        document.getElementById("newSaleModal").classList.add("flex");

        // Preencher formulário
        document.querySelector('input[name="product"]').value = sale.product;
        document.querySelector('input[name="unitPrice"]').value =
          sale.unitPrice;
        document.querySelector('input[name="quantity"]').value = sale.quantity;
        document.querySelector('input[name="customer"]').value = sale.customer;
        document.querySelector('input[name="invoice"]').value = sale.invoice;
        document.querySelector('input[name="date"]').value = sale.date;

        // Alterar envio do formulário para edição
        document.getElementById("saleForm").onsubmit = function (e) {
          e.preventDefault();

          // Obter dados atualizados
          const formData = new FormData(e.target);

          // Atualizar venda
          sale.product = formData.get("product");
          sale.unitPrice = parseFloat(formData.get("unitPrice"));
          sale.quantity = parseInt(formData.get("quantity"));
          sale.customer = formData.get("customer");
          sale.invoice = formData.get("invoice");
          sale.date = formData.get("date");

          // Recalcular total
          sale.total = sale.unitPrice * sale.quantity;

          // Atualizar data formatada
          const dateObj = new Date(sale.date);
          sale.formattedDate = `${String(dateObj.getDate()).padStart(
            2,
            "0"
          )}/${String(dateObj.getMonth() + 1).padStart(
            2,
            "0"
          )}/${dateObj.getFullYear()}`;

          // Atualizar tabela e gráficos
          updateSalesTable();
          updateCharts();

          // Fechar modal
          document.getElementById("newSaleModal").classList.add("hidden");
          document.getElementById("newSaleModal").classList.remove("flex");

          // Restaurar evento original
          document.getElementById("saleForm").onsubmit = null;
        };
      };

      window.deleteSale = function (id) {
        if (confirm("Tem certeza que deseja excluir esta venda?")) {
          const index = salesData.findIndex((s) => s.id === id);
          if (index !== -1) {
            salesData.splice(index, 1);

            // Atualizar tabela e gráficos
            updateSalesTable();
            updateCharts();
          }
        }
      };

      // Filtro de pesquisa
      document.getElementById("searchInput").addEventListener("input", (e) => {
        const searchTerm = e.target.value.toLowerCase();

        // Filtrar dados
        if (searchTerm) {
          const filteredData = salesData.filter(
            (sale) =>
              sale.product.toLowerCase().includes(searchTerm) ||
              sale.customer.toLowerCase().includes(searchTerm) ||
              sale.invoice.toLowerCase().includes(searchTerm)
          );

          // Exibir resultados filtrados
          const tableBody = document.getElementById("salesTableBody");
          tableBody.innerHTML = "";

          filteredData.forEach((sale) => {
            const row = document.createElement("tr");
            row.innerHTML = `
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">#${
                          sale.id
                        }</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${
                          sale.product
                        }</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${formatCurrency(
                          sale.unitPrice
                        )}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${
                          sale.quantity
                        }</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${formatCurrency(
                          sale.total
                        )}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${
                          sale.customer
                        }</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${
                          sale.invoice
                        }</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${
                          sale.formattedDate
                        }</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                            <div class="flex space-x-2">
                                <button class="text-primary hover:text-primary-dark" onclick="editSale(${
                                  sale.id
                                })">
                                    <div class="w-5 h-5 flex items-center justify-center">
                                        <i class="ri-edit-line"></i>
                                    </div>
                                </button>
                                <button class="text-red-600 hover:text-red-700" onclick="deleteSale(${
                                  sale.id
                                })">
                                    <div class="w-5 h-5 flex items-center justify-center">
                                        <i class="ri-delete-bin-line"></i>
                                    </div>
                                </button>
                            </div>
                        </td>
                    `;
            tableBody.appendChild(row);
          });

          // Atualizar informações de paginação
          document.getElementById("paginationInfo").innerHTML = `
                    Mostrando <span class="font-medium">${filteredData.length}</span> resultados filtrados
                `;

          // Desabilitar botões de paginação durante a pesquisa
          document.getElementById("prevPageBtn").disabled = true;
          document.getElementById("nextPageBtn").disabled = true;
        } else {
          // Restaurar exibição normal
          currentPage = 1;
          updateSalesTable();
        }
      });

      // Funcionalidade de exportação
      document
        .getElementById("exportDropdown")
        .addEventListener("click", () => {
          // Simulação de exportação
         // alert("Funcionalidade de exportação seria implementada aqui");
        });

      // Upload de XML
      // Modificar a parte do botão dropdown de exportação
      document.getElementById("exportDropdown").innerHTML = `
    <button id="exportBtn" class="bg-secondary text-white px-4 py-2 !rounded-button flex items-center space-x-2 whitespace-nowrap cursor-pointer">
        <div class="w-5 h-5 flex items-center justify-center">
            <i class="ri-download-line"></i>
        </div>
        <span>Exportar</span>
        <div class="w-5 h-5 flex items-center justify-center">
            <i class="ri-arrow-down-s-line"></i>
        </div>
    </button>
    <div id="exportMenu" class="absolute right-0 mt-2 w-48 bg-white rounded-lg shadow-lg py-1 z-10 hidden">
        <button class="w-full px-4 py-2 text-left text-sm text-gray-700 hover:bg-gray-100" data-format="csv">
            <div class="flex items-center space-x-2">
                <div class="w-5 h-5 flex items-center justify-center">
                    <i class="ri-file-text-line"></i>
                </div>
                <span>Exportar como CSV</span>
            </div>
        </button>
        <button class="w-full px-4 py-2 text-left text-sm text-gray-700 hover:bg-gray-100" data-format="excel">
            <div class="flex items-center space-x-2">
                <div class="w-5 h-5 flex items-center justify-center">
                    <i class="ri-file-excel-line"></i>
                </div>
                <span>Exportar como Excel</span>
            </div>
        </button>
        <button class="w-full px-4 py-2 text-left text-sm text-gray-700 hover:bg-gray-100" data-format="pdf">
            <div class="flex items-center space-x-2">
                <div class="w-5 h-5 flex items-center justify-center">
                    <i class="ri-file-pdf-line"></i>
                </div>
                <span>Exportar como PDF</span>
            </div>
        </button>
    </div>
`;

      // Modificar o botão de upload de XML
      document.getElementById("uploadXMLBtn").outerHTML = `
    <div class="relative">
        <input type="file" id="xmlFileInput" accept=".xml" class="absolute inset-0 opacity-0 w-full cursor-pointer" />
        <button id="uploadXMLBtn" class="bg-secondary text-white px-4 py-2 !rounded-button flex items-center space-x-2 whitespace-nowrap cursor-pointer">
            <div class="w-5 h-5 flex items-center justify-center">
                <i class="ri-upload-line"></i>
            </div>
            <span>Upload XML</span>
        </button>
    </div>
`;

      // Adicionar um modal para feedback de importação XML
      document.body.insertAdjacentHTML(
        "beforeend",
        `
    <div id="xmlImportModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
        <div class="bg-white rounded-lg w-full max-w-md mx-4">
            <div class="px-6 py-4 border-b border-gray-200 flex items-center justify-between">
                <h3 class="text-lg font-semibold text-gray-900">Importação de XML</h3>
                <button id="closeXmlModalBtn" class="text-gray-500 hover:text-gray-700">
                    <div class="w-6 h-6 flex items-center justify-center">
                        <i class="ri-close-line text-xl"></i>
                    </div>
                </button>
            </div>
            <div class="p-6">
                <div id="xmlImportStatus" class="mb-4"></div>
                <div id="xmlImportProgress" class="hidden">
                    <div class="w-full bg-gray-200 rounded-full h-2.5 mb-4">
                        <div id="progressBar" class="bg-primary h-2.5 rounded-full" style="width: 0%"></div>
                    </div>
                    <p id="progressText" class="text-sm text-gray-600">Processando...</p>
                </div>
                <div id="xmlImportResults" class="hidden space-y-2">
                    <div id="importedCount" class="flex items-center space-x-2">
                        <div class="w-5 h-5 flex items-center justify-center text-green-500">
                            <i class="ri-check-line"></i>
                        </div>
                        <span class="text-sm text-gray-700">0 vendas importadas com sucesso.</span>
                    </div>
                    <div id="updatedCount" class="flex items-center space-x-2">
                        <div class="w-5 h-5 flex items-center justify-center text-blue-500">
                            <i class="ri-refresh-line"></i>
                        </div>
                        <span class="text-sm text-gray-700">0 vendas atualizadas.</span>
                    </div>
                    <div id="errorCount" class="flex items-center space-x-2">
                        <div class="w-5 h-5 flex items-center justify-center text-red-500">
                            <i class="ri-error-warning-line"></i>
                        </div>
                        <span class="text-sm text-gray-700">0 erros encontrados.</span>
                    </div>
                </div>
            </div>
            <div class="px-6 py-4 border-t border-gray-200 flex justify-end">
                <button id="doneXmlBtn" class="bg-primary text-white px-4 py-2 !rounded-button">Concluído</button>
            </div>
        </div>
    </div>
`
      );

      // Adicionar eventos para menu de exportação
      document.getElementById("exportBtn").addEventListener("click", (e) => {
        e.stopPropagation();
        const menu = document.getElementById("exportMenu");
        menu.classList.toggle("hidden");
      });

      // Fechar o menu ao clicar fora dele
      document.addEventListener("click", (e) => {
        if (!e.target.closest("#exportDropdown")) {
          document.getElementById("exportMenu").classList.add("hidden");
        }
      });

      // Funções de exportação
      document.querySelectorAll("#exportMenu button").forEach((button) => {
        button.addEventListener("click", () => {
          const format = button.getAttribute("data-format");
          exportData(format);
          document.getElementById("exportMenu").classList.add("hidden");
        });
      });

      // Função para exportação de dados
      function exportData(format) {
        // Preparar os dados para exportação
        const dataToExport = salesData.map((sale) => ({
          ID: sale.id,
          Produto: sale.product,
          "Valor Unitário": sale.unitPrice,
          Quantidade: sale.quantity,
          Total: sale.total,
          Cliente: sale.customer,
          "Nota Fiscal": sale.invoice,
          Data: sale.formattedDate,
        }));

        switch (format) {
          case "csv":
            exportCSV(dataToExport);
            break;
          case "excel":
            exportExcel(dataToExport);
            break;
          case "pdf":
            exportPDF(dataToExport);
            break;
        }
      }

      // Exportar como CSV
      function exportCSV(data) {
        // Obter headers (nomes das colunas)
        const headers = Object.keys(data[0]);

        // Criar conteúdo CSV
        let csvContent = headers.join(";") + "\n";

        // Adicionar linhas
        data.forEach((row) => {
          const values = headers.map((header) => {
            const value = row[header];
            // Formatar valores numéricos com vírgula (padrão brasileiro)
            if (typeof value === "number") {
              return value.toString().replace(".", ",");
            }
            // Escapar aspas duplas e envolver em aspas se contiver ponto-e-vírgula
            const cellValue = String(value).replace(/"/g, '""');
            return cellValue.includes(";") ? `"${cellValue}"` : cellValue;
          });
          csvContent += values.join(";") + "\n";
        });

        // Criar blob e link para download
        const blob = new Blob([csvContent], {
          type: "text/csv;charset=utf-8;",
        });
        const url = URL.createObjectURL(blob);
        const link = document.createElement("a");
        link.setAttribute("href", url);
        link.setAttribute("download", `vendas_${getFormattedDate()}.csv`);
        link.style.visibility = "hidden";
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
      }

      // Exportar como Excel (na verdade é CSV com extensão .xlsx)
      function exportExcel(data) {
        // Obter headers (nomes das colunas)
        const headers = Object.keys(data[0]);

        // Criar conteúdo CSV
        let csvContent = headers.join("\t") + "\n";

        // Adicionar linhas
        data.forEach((row) => {
          const values = headers.map((header) => {
            const value = row[header];
            // Formatar valores com padrão brasileiro
            if (typeof value === "number") {
              return value.toString().replace(".", ",");
            }
            return String(value);
          });
          csvContent += values.join("\t") + "\n";
        });

        // Criar blob e link para download
        const blob = new Blob([csvContent], {
          type: "application/vnd.ms-excel",
        });
        const url = URL.createObjectURL(blob);
        const link = document.createElement("a");
        link.setAttribute("href", url);
        link.setAttribute("download", `vendas_${getFormattedDate()}.xlsx`);
        link.style.visibility = "hidden";
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
      }

      // Exportar como PDF (simulação básica)
      function exportPDF(data) {
        alert(
          "Para exportação real em PDF, seria necessário incluir uma biblioteca como jsPDF ou pdfmake. Esta é uma simulação da funcionalidade."
        );

        // Em um ambiente real, usaríamos código como este:
        /*
    import { jsPDF } from "jspdf";
    import "jspdf-autotable";
    
    const doc = new jsPDF();
    
    // Adicionar título
    doc.text("Relatório de Vendas", 14, 16);
    
    // Definir colunas e linhas para a tabela
    const tableColumn = Object.keys(data[0]);
    const tableRows = data.map(item => Object.values(item));
    
    // Adicionar tabela
    doc.autoTable({
        head: [tableColumn],
        body: tableRows,
        startY: 20,
    });
    
    // Salvar PDF
    doc.save(`vendas_${getFormattedDate()}.pdf`);
    */
      }

      // Funcionalidade de upload e processamento de XML
      document
        .getElementById("xmlFileInput")
        .addEventListener("change", (e) => {
          const file = e.target.files[0];
          if (file && file.type === "text/xml") {
            processXMLFile(file);
          } else {
            alert("Por favor, selecione um arquivo XML válido.");
          }
          // Limpar input para permitir selecionar o mesmo arquivo novamente
          e.target.value = "";
        });

      // Função para processar arquivo XML
      function processXMLFile(file) {
        // Mostrar modal de status
        const xmlImportModal = document.getElementById("xmlImportModal");
        const xmlImportStatus = document.getElementById("xmlImportStatus");
        const xmlImportProgress = document.getElementById("xmlImportProgress");
        const progressBar = document.getElementById("progressBar");
        const progressText = document.getElementById("progressText");
        const xmlImportResults = document.getElementById("xmlImportResults");

        xmlImportModal.classList.remove("hidden");
        xmlImportModal.classList.add("flex");
        xmlImportStatus.innerHTML = `<p class="text-center">Processando arquivo: ${file.name}</p>`;
        xmlImportProgress.classList.remove("hidden");
        xmlImportResults.classList.add("hidden");

        // Criar FileReader para ler o conteúdo do arquivo
        const reader = new FileReader();
        reader.onload = function (event) {
          const xmlContent = event.target.result;

          // Simulação de progresso
          let progress = 0;
          const interval = setInterval(() => {
            progress += 10;
            progressBar.style.width = `${progress}%`;
            progressText.textContent = `Processando... ${progress}%`;

            if (progress >= 100) {
              clearInterval(interval);
              setTimeout(() => {
                // Processar o XML (simulação)
                parseXML(xmlContent);
              }, 500);
            }
          }, 300);
        };

        reader.readAsText(file);
      }

      // Função para analisar o XML e extrair dados (simulação)
      function parseXML(xmlContent) {
        // Em um ambiente real, usaríamos o DOMParser para analisar o conteúdo XML
        const parser = new DOMParser();
        const xmlDoc = parser.parseFromString(xmlContent, "text/xml");

        // Simulação de dados extraídos
        // Normalmente, você faria algo como:
        // const vendas = xmlDoc.getElementsByTagName('venda');

        // Simulação de resultados
        const importedCount = Math.floor(Math.random() * 5) + 3; // 3-7 novas vendas
        const updatedCount = Math.floor(Math.random() * 3); // 0-2 atualizações
        const errorCount = Math.floor(Math.random() * 2); // 0-1 erros

        // Gerar vendas simuladas a partir do "XML"
        const simulatedSales = [];
        for (let i = 0; i < importedCount; i++) {
          const id = Math.max(0, ...salesData.map((s) => s.id)) + 1 + i;
          const product = [
            "Café Especial",
            "Açúcar Refinado",
            "Farinha de Trigo",
            "Leite Integral",
            "Queijo Mussarela",
          ][Math.floor(Math.random() * 5)];
          const unitPrice = parseFloat((Math.random() * 50 + 5).toFixed(2));
          const quantity = Math.floor(Math.random() * 20) + 1;
          const total = unitPrice * quantity;
          const customer = [
            "Mercado Central",
            "Restaurante Bom Sabor",
            "Padaria Delícia",
            "Supermercado Mais",
            "Lanchonete Express",
          ][Math.floor(Math.random() * 5)];
          const invoice = `NF-${Math.floor(Math.random() * 90000) + 10000}`;
          const today = new Date();
          const date = new Date(
            today.getFullYear(),
            today.getMonth(),
            today.getDate() - Math.floor(Math.random() * 30)
          )
            .toISOString()
            .split("T")[0];
          const dateObj = new Date(date);
          const formattedDate = `${String(dateObj.getDate()).padStart(
            2,
            "0"
          )}/${String(dateObj.getMonth() + 1).padStart(
            2,
            "0"
          )}/${dateObj.getFullYear()}`;

          simulatedSales.push({
            id,
            product,
            unitPrice,
            quantity,
            total,
            customer,
            invoice,
            date,
            formattedDate,
          });
        }

        // Adicionar vendas simuladas aos dados
        salesData.unshift(...simulatedSales);

        // Mostrar resultados
        document.getElementById("xmlImportProgress").classList.add("hidden");
        document.getElementById("xmlImportResults").classList.remove("hidden");
        document
          .getElementById("importedCount")
          .querySelector(
            "span"
          ).textContent = `${importedCount} vendas importadas com sucesso.`;
        document
          .getElementById("updatedCount")
          .querySelector(
            "span"
          ).textContent = `${updatedCount} vendas atualizadas.`;
        document
          .getElementById("errorCount")
          .querySelector(
            "span"
          ).textContent = `${errorCount} erros encontrados.`;

        // Atualizar a interface
        updateSalesTable();
        updateCharts();
      }

      // Eventos para o modal de importação XML
      document
        .getElementById("closeXmlModalBtn")
        .addEventListener("click", () => {
          document.getElementById("xmlImportModal").classList.add("hidden");
          document.getElementById("xmlImportModal").classList.remove("flex");
        });

      document.getElementById("doneXmlBtn").addEventListener("click", () => {
        document.getElementById("xmlImportModal").classList.add("hidden");
        document.getElementById("xmlImportModal").classList.remove("flex");
      });

      // Função auxiliar para obter data formatada para nomes de arquivo
      function getFormattedDate() {
        const now = new Date();
        return `${now.getFullYear()}${String(now.getMonth() + 1).padStart(
          2,
          "0"
        )}${String(now.getDate()).padStart(2, "0")}_${String(
          now.getHours()
        ).padStart(2, "0")}${String(now.getMinutes()).padStart(2, "0")}`;
      }

      // Inicializar aplicação
      window.addEventListener("load", () => {
        updateSalesTable();
        initCharts();

        // Ajustar gráficos quando a janela for redimensionada
        window.addEventListener("resize", () => {
          Object.values(charts).forEach((chart) => {
            chart.resize();
          });
        });
      });
    </script>
  </body>
</html>
